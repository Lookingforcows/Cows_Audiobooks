<script>
  function openFullscreen(url) {
    document.getElementById('fullscreenIframe').src = url;
    document.getElementById('fullscreenOverlay').style.display = 'block';
    document.getElementById('fullscreenContainer').style.display = 'block';
    document.body.style.overflow = 'hidden';
  }

  function closeFullscreen() {
    document.getElementById('fullscreenOverlay').style.display = 'none';
    document.getElementById('fullscreenContainer').style.display = 'none';
    document.getElementById('fullscreenIframe').src = '';
    document.body.style.overflow = 'auto';
  }

  async function fetchPodcastEpisodes() {
    const rssUrl = 'https://anchor.fm/s/e586064c/podcast/rss';

    try {
      const response = await fetch(rssUrl);
      if (!response.ok) throw new Error("Failed to fetch RSS feed");

      const xml = await response.text();
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xml, 'application/xml');
      const items = xmlDoc.getElementsByTagName('item');

      if (items.length === 0) {
        document.getElementById('episode-list').innerHTML = '<p>No episodes found.</p>';
        return;
      }

      const episodeList = document.getElementById('episode-list');
      episodeList.innerHTML = '';

      for (let i = 0; i < items.length; i++) {
        const item = items[i];

        const title = item.getElementsByTagName('title')[0]?.textContent || 'Untitled';
        const description = item.getElementsByTagName('description')[0]?.textContent || '';
        const enclosure = item.getElementsByTagName('enclosure')[0];
        const coverImage = item.getElementsByTagName('itunes:image')[0]?.getAttribute('href') || '';

        // Skip if no enclosure (no media file)
        if (!enclosure) continue;

        const link = enclosure.getAttribute('url') || '';
        const type = enclosure.getAttribute('type') || '';

        // Only include specific content
        if (title.toLowerCase().includes("full audiobook") || description.toLowerCase().includes("full audiobook")) {
          const episodeElement = document.createElement('div');
          episodeElement.classList.add('episode');

          let mediaPlayer = '';

          // Choose player based on media type
          if (type.includes('video') || link.endsWith('.mp4')) {
            mediaPlayer = `
              <video controls preload="none" width="100%">
                <source src="${link}" type="${type || 'video/mp4'}">
                Your browser does not support the video tag.
              </video>
            `;
          } else {
            mediaPlayer = `
              <audio controls preload="none">
                <source src="${link}" type="${type || 'audio/mpeg'}">
                Your browser does not support the audio element.
              </audio>
            `;
          }

          episodeElement.innerHTML = `
            <img src="${coverImage}" alt="${title}">
            <h3>${title}</h3>
            <p>${description}</p>
            ${mediaPlayer}
          `;

          episodeList.appendChild(episodeElement);
        }
      }
    } catch (error) {
      console.error("Error fetching RSS feed:", error);
      document.getElementById('episode-list').innerHTML = '<p>Error loading episodes.</p>';
    }
  }

  window.onload = fetchPodcastEpisodes;
</script>
